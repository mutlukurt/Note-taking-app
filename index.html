<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Not Alma Uygulaması</title>
    

    
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="light-mode">
    <div class="container">
        <header class="header">
            <h1 class="app-title">
                <i class="fas fa-sticky-note"></i>
                Not Alma Uygulaması
            </h1>
        </header>
        
        <!-- Ayarlar bölümü -->
        <div class="settings-section">
            <div class="settings-container">
                <button class="settings-toggle" id="settingsToggle" title="Ayarlar" onclick="toggleSettings()">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="settings-panel" id="settingsPanel">
                    <div class="settings-content">
                        <span class="settings-label">Ayarlar</span>
                        <div class="settings-buttons">
                            <button class="language-toggle" id="languageToggle" title="Dil Değiştir" onclick="toggleLanguage()">
                                <i class="fas fa-globe"></i>
                                <span class="lang-text">TR</span>
                            </button>
                            <button class="theme-toggle" id="themeToggle" title="Tema Değiştir">
                                <i class="fas fa-sun"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="note-form">
            <div class="input-group">
                <input type="text" id="noteTitle" placeholder="Not başlığı..." class="note-input">
                
                <!-- Rich Text Editor Toolbar -->
                <div class="editor-toolbar">
                    <button type="button" class="toolbar-btn" data-command="bold" title="Kalın">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="italic" title="İtalik">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="underline" title="Altı Çizili">
                        <i class="fas fa-underline"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="strikeThrough" title="Üstü Çizili">
                        <i class="fas fa-strikethrough"></i>
                    </button>
                    <div class="toolbar-separator"></div>
                    <!-- Header Selector -->
                    <div class="header-container">
                        <button type="button" class="toolbar-btn modern-btn" id="headerBtn" title="Başlık Formatı">
                            <i class="fas fa-heading"></i>
                            <span class="format-text">Normal</span>
                            <i class="fas fa-chevron-down dropdown-arrow"></i>
                        </button>
                        <div class="header-dropdown">
                            <button class="header-option" data-header="p" title="Normal Metin">
                                <div class="option-content">
                                    <span class="header-preview normal-preview">Aa</span>
                                    <div class="option-info">
                                        <span class="option-title">Normal</span>
                                        <span class="option-desc">Paragraf metni</span>
                                    </div>
                                </div>
                            </button>
                            <button class="header-option" data-header="h1" title="Büyük Başlık">
                                <div class="option-content">
                                    <span class="header-preview h1-preview">H1</span>
                                    <div class="option-info">
                                        <span class="option-title">Başlık 1</span>
                                        <span class="option-desc">Ana başlık</span>
                                    </div>
                                </div>
                            </button>
                            <button class="header-option" data-header="h2" title="Orta Başlık">
                                <div class="option-content">
                                    <span class="header-preview h2-preview">H2</span>
                                    <div class="option-info">
                                        <span class="option-title">Başlık 2</span>
                                        <span class="option-desc">Alt başlık</span>
                                    </div>
                                </div>
                            </button>
                            <button class="header-option" data-header="h3" title="Küçük Başlık">
                                <div class="option-content">
                                    <span class="header-preview h3-preview">H3</span>
                                    <div class="option-info">
                                        <span class="option-title">Başlık 3</span>
                                        <span class="option-desc">Küçük başlık</span>
                                    </div>
                                </div>
                            </button>
                        </div>
                    </div>
                    <div class="toolbar-separator"></div>
                    <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Liste">
                        <i class="fas fa-list-ul"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Numaralı Liste">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <div class="toolbar-separator"></div>
                    <button type="button" class="toolbar-btn" data-command="justifyLeft" title="Sola Hizala">
                        <i class="fas fa-align-left"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="justifyCenter" title="Ortala">
                        <i class="fas fa-align-center"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="justifyRight" title="Sağa Hizala">
                        <i class="fas fa-align-right"></i>
                    </button>
                    <div class="toolbar-separator"></div>
                    <button type="button" class="toolbar-btn" id="imageBtn" title="Fotoğraf Ekle" onclick="document.getElementById('imageInput').click()">
                        <i class="fas fa-image"></i>
                    </button>
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    <div class="toolbar-separator"></div>
                    <!-- Color Swatches in Toolbar -->
                    <div class="color-swatches-container">
                        <div class="color-swatch" data-color="#000000" title="Siyah" style="background-color: #000000;"></div>
                        <div class="color-swatch" data-color="#ff0000" title="Kırmızı" style="background-color: #ff0000;"></div>
                        <div class="color-swatch" data-color="#00ff00" title="Yeşil" style="background-color: #00ff00;"></div>
                        <div class="color-swatch" data-color="#0066ff" title="Mavi" style="background-color: #0066ff;"></div>
                        <div class="color-swatch" data-color="#ffcc00" title="Sarı" style="background-color: #ffcc00;"></div>
                        <div class="color-swatch" data-color="#ff6600" title="Turuncu" style="background-color: #ff6600;"></div>
                        <div class="color-swatch" data-color="#6600ff" title="Mor" style="background-color: #6600ff;"></div>
                        <div class="color-swatch" data-color="#ff00ff" title="Pembe" style="background-color: #ff00ff;"></div>
                    </div>
                </div>
                
                <div id="noteContent" class="note-textarea rich-editor" contenteditable="true" data-placeholder="Notunuzu buraya yazın..."></div>
            </div>
            <div class="button-group">
                <button id="addNote" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    Not Ekle
                </button>
                <button id="clearForm" class="btn btn-secondary">
                    <i class="fas fa-eraser"></i>
                    Temizle
                </button>
                <button id="exportPDF" class="btn btn-export">
                    <i class="fas fa-file-pdf"></i>
                    PDF Aktar
                </button>
            </div>
        </div>

        <div class="search-section">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Notlarınızda arayın..." class="search-input">
            </div>
        </div>

        <div class="notes-controls">
            <div class="sort-controls">
                <span style="color: var(--text-secondary); font-size: 0.9rem; margin-right: 10px;">Sırala:</span>
                <button class="sort-btn active" data-sort="date-desc">En Yeni</button>
                <button class="sort-btn" data-sort="date-asc">En Eski</button>
                <button class="sort-btn" data-sort="title">Başlık</button>
            </div>
            <div class="pin-controls">
                <button class="pin-filter active" data-filter="all">Tümü</button>
                <button class="pin-filter" data-filter="pinned">Sabitlenenler</button>
                <button class="pin-filter" data-filter="unpinned">Normal</button>
            </div>
        </div>

        <div class="notes-container" id="notesContainer">
            <!-- Notlar buraya dinamik olarak eklenecek -->
        </div>

        <div class="empty-state" id="emptyState">
            <i class="fas fa-notes-medical"></i>
            <h3>Henüz not eklenmemiş</h3>
            <p>İlk notunuzu ekleyerek başlayın!</p>
        </div>
    </div>



    <script>
        // Real functions
        function toggleTheme() {
            const body = document.body;
            const icon = document.querySelector('#themeToggle i');
            
            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        function addNote() {
            const title = document.getElementById('noteTitle').value;
            const content = document.getElementById('noteContent').innerHTML;
            
            if (!title && !content) {
                alert('Lütfen en az bir başlık veya içerik girin!');
                return;
            }
            
            // Create note object
            const note = {
                id: Date.now(),
                title: title || 'Başlıksız Not',
                content: content || 'İçerik yok',
                date: new Date().toLocaleString('tr-TR'),
                timestamp: Date.now(),
                pinned: false
            };
            
            // Get notes from localStorage
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            notes.unshift(note); // Add to beginning
            localStorage.setItem('notes', JSON.stringify(notes));
            
            // Clear form
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').innerHTML = '';
            
            // Show success message
            showNotification('Not başarıyla eklendi!', 'success');
            
            // Refresh notes display
            renderNotes();
        }
        
        function clearForm() {
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').innerHTML = '';
        }
        
        // Color palette functions removed - colors now in toolbar
        
        // Mobile-optimized caret position preservation using Selection and Range APIs
        function saveCaretPosition() {
            const editor = document.getElementById('noteContent');
            const selection = window.getSelection();
            
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                
                // Create a comprehensive bookmark for mobile compatibility
                const bookmark = {
                    startContainer: range.startContainer,
                    startOffset: range.startOffset,
                    endContainer: range.endContainer,
                    endOffset: range.endOffset,
                    collapsed: range.collapsed,
                    commonAncestorContainer: range.commonAncestorContainer,
                    timestamp: Date.now() // For mobile browser compatibility
                };
                
                // Save text position as backup for mobile browsers
                try {
                    const preCaretRange = range.cloneRange();
                    preCaretRange.selectNodeContents(editor);
                    preCaretRange.setEnd(range.endContainer, range.endOffset);
                    bookmark.textBefore = preCaretRange.toString().length;
                    
                    // Save character offset for better mobile support
                    const allText = editor.textContent || editor.innerText;
                    const selectedText = range.toString();
                    bookmark.charOffset = bookmark.textBefore;
                    bookmark.selectedText = selectedText;
                } catch (e) {
                    console.log('Text position calculation failed, using fallback');
                    bookmark.textBefore = 0;
                    bookmark.charOffset = 0;
                }
                
                return bookmark;
            }
            return null;
        }
        
        function restoreCaretPosition(bookmark) {
            if (!bookmark) return false;
            
            const editor = document.getElementById('noteContent');
            const selection = window.getSelection();
            
            // Mobile-optimized restoration with multiple fallback strategies
            try {
                // Primary method: Direct DOM reference restoration
                const range = document.createRange();
                range.setStart(bookmark.startContainer, bookmark.startOffset);
                range.setEnd(bookmark.endContainer, bookmark.endOffset);
                
                selection.removeAllRanges();
                selection.addRange(range);
                
                // Verify restoration worked
                if (selection.rangeCount > 0) {
                    const restoredRange = selection.getRangeAt(0);
                    if (restoredRange.startContainer === bookmark.startContainer &&
                        restoredRange.startOffset === bookmark.startOffset) {
                        return true;
                    }
                }
            } catch (e) {
                console.log('Direct restoration failed, trying fallback methods');
            }
            
            // Fallback 1: Text position restoration
            if (bookmark.textBefore !== undefined) {
                if (restoreCaretByTextPosition(editor, bookmark.textBefore)) {
                    return true;
                }
            }
            
            // Fallback 2: Character offset restoration
            if (bookmark.charOffset !== undefined) {
                if (restoreCaretByCharOffset(editor, bookmark.charOffset)) {
                    return true;
                }
            }
            
            // Final fallback: Place cursor at end
            return placeCursorAtEnd(editor);
        }
        
        function restoreCaretByTextPosition(editor, textBefore) {
            const selection = window.getSelection();
            const textNodes = [];
            
            // Collect all text nodes in the editor
            const walker = document.createTreeWalker(
                editor,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            let node;
            while (node = walker.nextNode()) {
                textNodes.push(node);
            }
            
            // Find the correct position
            let currentLength = 0;
            for (let i = 0; i < textNodes.length; i++) {
                const nodeLength = textNodes[i].length;
                if (currentLength + nodeLength >= textBefore) {
                    const offset = Math.min(textBefore - currentLength, nodeLength);
                    const range = document.createRange();
                    range.setStart(textNodes[i], offset);
                    range.setEnd(textNodes[i], offset);
                    selection.removeAllRanges();
                    selection.addRange(range);
                    return true;
                }
                currentLength += nodeLength;
            }
            
            // If we can't find the position, place cursor at the end
            if (textNodes.length > 0) {
                const lastNode = textNodes[textNodes.length - 1];
                const range = document.createRange();
                range.setStart(lastNode, lastNode.length);
                range.setEnd(lastNode, lastNode.length);
                selection.removeAllRanges();
                selection.addRange(range);
                return true;
            }
            
            return false;
        }
        
        function restoreCaretByCharOffset(editor, charOffset) {
            const selection = window.getSelection();
            const allText = editor.textContent || editor.innerText;
            
            if (charOffset > allText.length) {
                charOffset = allText.length;
            }
            
            // Find the text node containing the character offset
            const walker = document.createTreeWalker(
                editor,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            let node;
            let currentOffset = 0;
            
            while (node = walker.nextNode()) {
                const nodeLength = node.length;
                if (currentOffset + nodeLength >= charOffset) {
                    const localOffset = charOffset - currentOffset;
                    const range = document.createRange();
                    range.setStart(node, localOffset);
                    range.setEnd(node, localOffset);
                    selection.removeAllRanges();
                    selection.addRange(range);
                    return true;
                }
                currentOffset += nodeLength;
            }
            
            return false;
        }
        
        function placeCursorAtEnd(editor) {
            const selection = window.getSelection();
            const range = document.createRange();
            
            // Find the last text node
            const walker = document.createTreeWalker(
                editor,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            let lastNode = null;
            let node;
            while (node = walker.nextNode()) {
                lastNode = node;
            }
            
            if (lastNode) {
                range.setStart(lastNode, lastNode.length);
                range.setEnd(lastNode, lastNode.length);
            } else {
                range.selectNodeContents(editor);
                range.collapse(false);
            }
            
            selection.removeAllRanges();
            selection.addRange(range);
            return true;
        }
        
        function applyTextColor(color) {
            const editor = document.getElementById('noteContent');
            if (!editor) return;
            
            // Save current state for mobile compatibility
            const scrollTop = editor.scrollTop;
            const scrollLeft = editor.scrollLeft;
            const wasFocused = document.activeElement === editor;
            
            // Save caret position before any DOM changes
            const caretBookmark = saveCaretPosition();
            
            // Mobile-optimized focus handling
            if (!wasFocused) {
                editor.focus();
            }
            
            // Restore caret position with mobile-specific handling
            if (caretBookmark) {
                restoreCaretPosition(caretBookmark);
            }
            
            // Apply color from current caret position onward
            let success = false;
            try {
                // Try execCommand first
                success = document.execCommand('foreColor', false, color);
            } catch (e) {
                console.log('execCommand failed, using manual approach');
            }
            
            // If execCommand fails, use manual approach
            if (!success) {
                const selection = window.getSelection();
                
                if (caretBookmark) {
                    // Create a range from the saved caret position to the end
                    const range = document.createRange();
                    range.setStart(caretBookmark.startContainer, caretBookmark.startOffset);
                    
                    // Find the end of the editor content
                    const endRange = document.createRange();
                    endRange.selectNodeContents(editor);
                    endRange.collapse(false);
                    range.setEnd(endRange.endContainer, endRange.endOffset);
                    
                    // Check if there's content to color
                    const contentToColor = range.toString();
                    
                    if (contentToColor.length > 0) {
                        // Color the text from caret position to end
                        const span = document.createElement('span');
                        span.style.color = color;
                        span.textContent = contentToColor;
                        range.deleteContents();
                        range.insertNode(span);
                        
                        // Position cursor at the end of the colored text
                        const newRange = document.createRange();
                        newRange.setStartAfter(span);
                        newRange.collapse(true);
                        selection.removeAllRanges();
                        selection.addRange(newRange);
                    } else {
                        // No content to color, insert a colored space at caret position
                        const span = document.createElement('span');
                        span.style.color = color;
                        span.innerHTML = '&nbsp;';
                        range.insertNode(span);
                        
                        // Position cursor after the span
                        const newRange = document.createRange();
                        newRange.setStartAfter(span);
                        newRange.collapse(true);
                        selection.removeAllRanges();
                        selection.addRange(newRange);
                    }
                } else {
                    // No saved position, insert colored text at the end
                    const span = document.createElement('span');
                    span.style.color = color;
                    span.innerHTML = '&nbsp;';
                    editor.appendChild(span);
                    
                    // Position cursor after the span
                    const newRange = document.createRange();
                    newRange.setStartAfter(span);
                    newRange.collapse(true);
                    selection.removeAllRanges();
                    selection.addRange(newRange);
                }
            }
            
            // Save the color preference
            localStorage.setItem('noteTextColor', color);
            
            // Mobile-optimized final restoration
            if (caretBookmark) {
                // Use requestAnimationFrame for better mobile performance
                requestAnimationFrame(() => {
                    restoreCaretPosition(caretBookmark);
                    
                    // Ensure focus is maintained on mobile
                    if (wasFocused) {
                        editor.focus();
                    }
                });
            }
            
            // Restore scroll position with mobile-specific timing
            requestAnimationFrame(() => {
                editor.scrollTop = scrollTop;
                editor.scrollLeft = scrollLeft;
            });
            
            // Return focus to editor for seamless typing
            setTimeout(() => {
                editor.focus();
                if (caretBookmark) {
                    restoreCaretPosition(caretBookmark);
                }
            }, 10);
        }
        

        

        
        // Apply text color function
        function applyTextColor(color) {
            const editor = document.getElementById('noteContent');
            
            if (!editor) {
                console.error('Editor not found!');
                return;
            }

            // Focus editor first
            editor.focus();
            
            // Check if there's a selection
            const selection = window.getSelection();
            
            if (selection.rangeCount > 0 && !selection.isCollapsed) {
                // Apply color to selected text
                document.execCommand('foreColor', false, color);
            } else {
                // No selection, apply color to cursor position
                document.execCommand('foreColor', false, color);
            }
        }
        
        // Show notification function
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : '#2196F3'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 10001;
                font-size: 14px;
                font-weight: 500;
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // DOM loaded
        document.addEventListener('DOMContentLoaded', function() {
            
            // Set up buttons
            const themeBtn = document.getElementById('themeToggle');
            if (themeBtn) {
                themeBtn.onclick = toggleTheme;
            }
            
            const addBtn = document.getElementById('addNote');
            if (addBtn) {
                addBtn.onclick = addNote;
            }
            
            const clearBtn = document.getElementById('clearForm');
            if (clearBtn) {
                clearBtn.onclick = clearForm;
            }
            
            // Set up search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.oninput = (e) => {
                    searchNotes(e.target.value);
                };
            }
            
            // Set up PDF export button
            const exportBtn = document.getElementById('exportPDF');
            if (exportBtn) {
                exportBtn.onclick = exportToPDF;
            }
            
            // Set up rich text editor toolbar
            setupRichTextEditor();
            
            // Set up language toggle
            setupLanguageToggle();
            
                        // Set up settings toggle
            setupSettingsToggle();
            
            // Set up color palette
            // setupColorPalette() removed - colors now in toolbar
            
            // Load and display notes
            renderNotes();
        });
        
        // Function to render notes
        function renderNotes() {
            const notes = JSON.parse(localStorage.getItem('notes')) || [];
            const container = document.getElementById('notesContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (notes.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'flex';
                return;
            }
            
            emptyState.style.display = 'none';
            container.innerHTML = '';
            
            notes.forEach(note => {
                const noteCard = createNoteCard(note);
                container.appendChild(noteCard);
            });
        }
        
        // Function to create note card
        function createNoteCard(note) {
            const card = document.createElement('div');
            card.className = 'note-card';
            if (note.pinned) card.classList.add('pinned');
            
            card.innerHTML = `
                <div class="note-header">
                    <h3 class="note-title">${note.title}</h3>
                    <span class="note-date">${note.date}</span>
                </div>
                <div class="note-content">${note.content}</div>
                <div class="note-actions">
                    <button class="action-btn pin" onclick="togglePin(${note.id})" title="Sabitle">
                        <i class="fas fa-thumbtack"></i>
                    </button>
                    <button class="action-btn edit" onclick="editNote(${note.id})" title="Düzenle">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete" onclick="deleteNote(${note.id})" title="Sil">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="swipe-delete" data-note-id="${note.id}" onclick="deleteNoteWithUndo(${note.id})">
                    <i class="fas fa-trash"></i>
                    <span>Sil</span>
                </div>
            `;
            
            // Add swipe functionality after creating the card
            addSwipeFunctionality(card, note.id);
            
            return card;
        }
        
        // Function to delete note
        function deleteNote(id) {
            if (confirm('Bu notu silmek istediğinizden emin misiniz?')) {
                let notes = JSON.parse(localStorage.getItem('notes')) || [];
                notes = notes.filter(note => note.id !== id);
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotes();
                alert('Not silindi!');
            }
        }
        
        // Function to toggle pin
        function togglePin(id) {
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            const note = notes.find(note => note.id === id);
            if (note) {
                note.pinned = !note.pinned;
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotes();
            }
        }
        
        // Function to edit note
        function editNote(id) {
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            const note = notes.find(note => note.id === id);
            if (note) {
                document.getElementById('noteTitle').value = note.title;
                document.getElementById('noteContent').innerHTML = note.content;
                
                // Change add button to update button temporarily
                const addBtn = document.getElementById('addNote');
                addBtn.innerHTML = '<i class="fas fa-save"></i> Güncelle';
                addBtn.onclick = () => updateNote(id);
            }
        }
        
        // Function to update note
        function updateNote(id) {
            const title = document.getElementById('noteTitle').value;
            const content = document.getElementById('noteContent').innerHTML;
            
            if (!title && !content) {
                alert('Lütfen en az bir başlık veya içerik girin!');
                return;
            }
            
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            const noteIndex = notes.findIndex(note => note.id === id);
            
            if (noteIndex !== -1) {
                notes[noteIndex].title = title || 'Başlıksız Not';
                notes[noteIndex].content = content || 'İçerik yok';
                notes[noteIndex].date = new Date().toLocaleString('tr-TR');
                
                localStorage.setItem('notes', JSON.stringify(notes));
                
                // Reset form and button
                document.getElementById('noteTitle').value = '';
                document.getElementById('noteContent').innerHTML = '';
                
                const addBtn = document.getElementById('addNote');
                addBtn.innerHTML = '<i class="fas fa-plus"></i> Not Ekle';
                addBtn.onclick = testAddNote;
                
                renderNotes();
                alert('Not güncellendi!');
            }
        }
        
        // Function to search notes
        function searchNotes(query) {
            const notes = JSON.parse(localStorage.getItem('notes')) || [];
            const container = document.getElementById('notesContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (!query.trim()) {
                renderNotes();
                return;
            }
            
            const filteredNotes = notes.filter(note => 
                note.title.toLowerCase().includes(query.toLowerCase()) ||
                note.content.toLowerCase().includes(query.toLowerCase())
            );
            
            if (filteredNotes.length === 0) {
                container.innerHTML = '';
                emptyState.innerHTML = `
                    <i class="fas fa-search"></i>
                    <h3>Arama sonucu bulunamadı</h3>
                    <p>"${query}" için sonuç yok</p>
                `;
                emptyState.style.display = 'flex';
                return;
            }
            
            emptyState.style.display = 'none';
            container.innerHTML = '';
            
            filteredNotes.forEach(note => {
                const noteCard = createNoteCard(note);
                container.appendChild(noteCard);
            });
        }
        
        // Swipe functionality
        function addSwipeFunctionality(card, noteId) {
            let startX = 0;
            let currentX = 0;
            let isDragging = false;
            let isSwiped = false;
            
            // Mouse events for desktop testing
            card.addEventListener('mousedown', (e) => {
                startX = e.clientX;
                isDragging = true;
                card.style.cursor = 'grabbing';
            });
            
            card.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                currentX = e.clientX;
                const diff = startX - currentX;
                
                if (diff > 0) {
                    card.style.transform = `translateX(-${Math.min(diff, 80)}px)`;
                }
            });
            
            card.addEventListener('mouseup', () => {
                if (!isDragging) return;
                
                const diff = startX - currentX;
                if (diff > 80) {
                    card.style.transform = 'translateX(-80px)';
                    isSwiped = true;
                } else {
                    card.style.transform = 'translateX(0)';
                    isSwiped = false;
                }
                
                isDragging = false;
                card.style.cursor = 'grab';
            });
            
            // Touch events for mobile
            card.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
            });
            
            card.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                
                currentX = e.touches[0].clientX;
                const diff = startX - currentX;
                
                if (diff > 0) {
                    e.preventDefault();
                    card.style.transform = `translateX(-${Math.min(diff, 80)}px)`;
                }
            });
            
            card.addEventListener('touchend', () => {
                if (!isDragging) return;
                
                const diff = startX - currentX;
                if (diff > 80) {
                    card.style.transform = 'translateX(-80px)';
                    isSwiped = true;
                } else {
                    card.style.transform = 'translateX(0)';
                    isSwiped = false;
                }
                
                isDragging = false;
            });
            
            // Click outside to reset
            document.addEventListener('click', (e) => {
                if (!card.contains(e.target) && isSwiped) {
                    card.style.transform = 'translateX(0)';
                    isSwiped = false;
                }
            });
            
            // Add click event to swipe delete button
            const swipeDeleteBtn = card.querySelector('.swipe-delete');
            if (swipeDeleteBtn) {
                swipeDeleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteNoteWithUndo(noteId);
                    card.style.transform = 'translateX(0)';
                    isSwiped = false;
                });
            }
        }
        
        // Delete note with undo
        function deleteNoteWithUndo(id) {
            const noteId = parseInt(id);
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            const noteIndex = notes.findIndex(note => note.id === noteId);
            
            if (noteIndex === -1) return;
            
            const deletedNote = notes[noteIndex];
            notes.splice(noteIndex, 1);
            localStorage.setItem('notes', JSON.stringify(notes));
            
            // Show undo notification
            showUndoNotification(deletedNote, noteIndex);
            
            // Refresh display
            renderNotes();
        }
        
        // Show undo notification
        function showUndoNotification(note, originalIndex) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'undo-notification';
            notification.innerHTML = `
                <span>Not silindi</span>
                <button onclick="undoDelete(${note.id}, ${originalIndex})">Geri Al</button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 4000);
        }
        
        // Undo delete
        function undoDelete(noteId, originalIndex) {
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            const deletedNote = notes.find(note => note.id === noteId);
            
            if (deletedNote) {
                notes.splice(originalIndex, 0, deletedNote);
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotes();
            }
            
            // Remove notification
            const notification = document.querySelector('.undo-notification');
            if (notification) {
                notification.parentNode.removeChild(notification);
            }
        }
        
        // PDF Export Function
        function exportToPDF() {
            const title = document.getElementById('noteTitle').value;
            const content = document.getElementById('noteContent').innerHTML;
            
            if (!title && !content) {
                alert('PDF oluşturmak için en az bir başlık veya içerik girin!');
                return;
            }
            
            // Create a temporary container for PDF content
            const pdfContainer = document.createElement('div');
            pdfContainer.style.cssText = `
                position: fixed;
                top: -9999px;
                left: -9999px;
                width: 800px;
                background: white;
                padding: 40px;
                font-family: Arial, sans-serif;
                color: #333;
                line-height: 1.6;
            `;
            
            pdfContainer.innerHTML = `
                <h1 style="color: #667eea; margin-bottom: 20px; font-size: 24px;">${title || 'Başlıksız Not'}</h1>
                <div style="margin-bottom: 20px; color: #666; font-size: 14px;">
                    Oluşturulma Tarihi: ${new Date().toLocaleString('tr-TR')}
                </div>
                <div style="font-size: 16px;">${content || 'İçerik yok'}</div>
            `;
            
            document.body.appendChild(pdfContainer);
            
            // Use html2canvas to capture the content
            html2canvas(pdfContainer, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                // Remove the temporary container
                document.body.removeChild(pdfContainer);
                
                // Create PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = pdfWidth;
                const pageHeight = pdfHeight;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Download the PDF
                const fileName = `${title || 'not'}_${new Date().toISOString().slice(0, 10)}.pdf`;
                pdf.save(fileName);
                
                alert('PDF başarıyla indirildi!');
            }).catch(error => {
                console.error('PDF oluşturma hatası:', error);
                alert('PDF oluşturulurken bir hata oluştu. Lütfen tekrar deneyin.');
                document.body.removeChild(pdfContainer);
            });
        }
        
        // Rich Text Editor Setup
        function setupRichTextEditor() {
            const toolbar = document.querySelector('.editor-toolbar');
            const editor = document.getElementById('noteContent');
            const imageInput = document.getElementById('imageInput');
            
            // Toolbar button clicks
            if (toolbar) {
                toolbar.addEventListener('click', (e) => {
                    const btn = e.target.closest('.toolbar-btn');
                    if (btn) {
                        const command = btn.dataset.command;
                        
                        if (command) {
                            e.preventDefault();
                            e.stopPropagation();
                            
                            // Focus editor first
                            editor.focus();
                            
                            // Execute command
                            const success = document.execCommand(command, false, null);
                            
                            // Add visual feedback
                            btn.classList.add('active');
                            setTimeout(() => btn.classList.remove('active'), 200);
                        }
                    }
                });
            }
            
            // Image upload
            const addImageBtn = document.getElementById('imageBtn');
            if (addImageBtn) {
                addImageBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    imageInput.click();
                });
            }
            
            if (imageInput) {
                imageInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    
                    if (file && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.style.maxWidth = '100%';
                            img.style.height = 'auto';
                            img.style.borderRadius = '10px';
                            img.style.margin = '10px 0';
                            
                            editor.focus();
                            const success = document.execCommand('insertHTML', false, img.outerHTML);
                            
                            // Clear the input
                            imageInput.value = '';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        alert('Lütfen geçerli bir resim dosyası seçin!');
                    }
                });
            }
            
            // Header dropdown functionality
            const headerBtn = document.getElementById('headerBtn');
            const headerContainer = document.querySelector('.header-container');
            const headerDropdown = document.querySelector('.header-dropdown');
            const headerOptions = document.querySelectorAll('.header-option');
            
            if (headerBtn && headerContainer && headerDropdown) {
                // Toggle dropdown on button click
                headerBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    headerContainer.classList.toggle('active');
                    headerDropdown.classList.toggle('active');
                });
                
                // Handle header option clicks
                headerOptions.forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const headerType = option.dataset.header;
                        const formatText = option.querySelector('.option-title').textContent;
                        
                        // Update button text
                        const formatTextElement = headerBtn.querySelector('.format-text');
                        if (formatTextElement) {
                            formatTextElement.textContent = formatText;
                        }
                        
                        // Apply header format
                        editor.focus();
                        
                        if (headerType === 'p') {
                            document.execCommand('formatBlock', false, 'p');
                        } else {
                            document.execCommand('formatBlock', false, headerType);
                        }
                        
                        // Close dropdown
                        headerContainer.classList.remove('active');
                        headerDropdown.classList.remove('active');
                        
                        // Add visual feedback
                        option.classList.add('selected');
                        setTimeout(() => option.classList.remove('selected'), 200);
                    });
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!headerContainer.contains(e.target)) {
                        headerContainer.classList.remove('active');
                        headerDropdown.classList.remove('active');
                    }
                });
            }
            
            // Color picker functionality
            const colorPaletteBtn = document.getElementById('colorPaletteBtn');
            
            // Color palette button click handler
            if (colorPaletteBtn) {
                colorPaletteBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    openColorPalette();
                });
            }
            
                    // Color swatches in toolbar
        const colorSwatches = document.querySelectorAll('.color-swatch');
        
        if (colorSwatches.length > 0) {
            colorSwatches.forEach(swatch => {
                // Unified click/touch handler for all devices
                const handleColorSelect = (e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    
                    // Visual feedback
                    swatch.style.transform = 'scale(0.95)';
                    
                    // Remove selected class from all swatches
                    colorSwatches.forEach(s => s.classList.remove('selected'));
                    
                    // Add selected class to selected swatch
                    swatch.classList.add('selected');
                    
                    const color = swatch.dataset.color;
                    
                    // Apply color directly
                    applyTextColor(color);
                    
                    // Reset transform after a short delay
                    setTimeout(() => {
                        swatch.style.transform = '';
                    }, 150);
                };
                
                // Click event for desktop
                swatch.addEventListener('click', handleColorSelect);
                
                // Touch events for mobile (with passive: false for preventDefault)
                swatch.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                }, { passive: false });
                
                swatch.addEventListener('touchend', handleColorSelect, { passive: false });
                
                // Prevent text selection on mobile
                swatch.addEventListener('selectstart', (e) => {
                    e.preventDefault();
                });
            });
        }
            
            // Apply background color function
            function applyBackgroundColor(color) {
                const noteCards = document.querySelectorAll('.note-card');
                noteCards.forEach(card => {
                    card.style.backgroundColor = color;
                });
                localStorage.setItem('backgroundColor', color);
                showNotification('Arka plan rengi değiştirildi!', 'success');
            }
        }
        
        // Settings Toggle Setup
        function setupSettingsToggle() {
            const settingsBtn = document.getElementById('settingsToggle');
            const settingsPanel = document.getElementById('settingsPanel');
            let isSettingsOpen = false;
            
            if (settingsBtn && settingsPanel) {
                settingsBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    isSettingsOpen = !isSettingsOpen;
                    
                    if (isSettingsOpen) {
                        settingsBtn.classList.add('active');
                        settingsPanel.classList.add('active');
                    } else {
                        settingsBtn.classList.remove('active');
                        settingsPanel.classList.remove('active');
                    }
                });
                
                // Close settings panel when clicking outside
                document.addEventListener('click', (e) => {
                    if (!settingsBtn.contains(e.target) && !settingsPanel.contains(e.target)) {
                        if (isSettingsOpen) {
                            settingsBtn.classList.remove('active');
                            settingsPanel.classList.remove('active');
                            isSettingsOpen = false;
                        }
                    }
                });
            }
        }
        
        // Color Palette Setup removed - colors now in toolbar
        
        // Language Toggle Setup
        function setupLanguageToggle() {
            const languageBtn = document.getElementById('languageToggle');
            let currentLanguage = localStorage.getItem('language') || 'tr';
            
            // Set initial language
            updateLanguage(currentLanguage);
            
            if (languageBtn) {
                languageBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    currentLanguage = currentLanguage === 'tr' ? 'en' : 'tr';
                    
                    localStorage.setItem('language', currentLanguage);
                    updateLanguage(currentLanguage);
                });
            }
        }
        
        // Update language function
        function updateLanguage(lang) {
            const t = translations[lang];
            
            // Update language button
            const languageBtn = document.getElementById('languageToggle');
            const langText = languageBtn.querySelector('.lang-text');
            
            if (lang === 'en') {
                languageBtn.classList.add('english');
                langText.textContent = 'EN';
            } else {
                languageBtn.classList.remove('english');
                langText.textContent = 'TR';
            }
            
            // Update main elements
            document.querySelector('.app-title').innerHTML = `<i class="fas fa-sticky-note"></i> ${t.appTitle}`;
            document.querySelector('.settings-label').textContent = t.themeLabel;
            document.getElementById('noteTitle').placeholder = t.noteTitlePlaceholder;
            document.getElementById('noteContent').setAttribute('data-placeholder', t.noteContentPlaceholder);
            document.getElementById('addNote').innerHTML = `<i class="fas fa-plus"></i> ${t.addNote}`;
            document.getElementById('clearForm').innerHTML = `<i class="fas fa-eraser"></i> ${t.clearForm}`;
            document.getElementById('exportPDF').innerHTML = `<i class="fas fa-file-pdf"></i> ${t.exportPDF}`;
            document.getElementById('searchInput').placeholder = t.searchPlaceholder;
            
            // Update toolbar buttons
            document.querySelector('[data-command="bold"]').title = t.toolbarBold;
            document.querySelector('[data-command="italic"]').title = t.toolbarItalic;
            document.querySelector('[data-command="underline"]').title = t.toolbarUnderline;
            document.querySelector('[data-command="strikeThrough"]').title = t.toolbarStrike;
            document.querySelector('[data-command="insertUnorderedList"]').title = t.toolbarList;
            document.querySelector('[data-command="insertOrderedList"]').title = t.toolbarOrderedList;
            document.querySelector('[data-command="justifyLeft"]').title = t.toolbarLeft;
            document.querySelector('[data-command="justifyCenter"]').title = t.toolbarCenter;
            document.querySelector('[data-command="justifyRight"]').title = t.toolbarRight;
            document.getElementById('imageBtn').title = t.toolbarImage;
            document.getElementById('colorPaletteBtn').title = t.toolbarBackgroundColor;
            
            // Update controls
            const sortSpan = document.querySelector('.sort-controls span');
            if (sortSpan) sortSpan.textContent = t.sortLabel;
            
            const newestBtn = document.querySelector('[data-sort="date-desc"]');
            if (newestBtn) newestBtn.textContent = t.newest;
            
            const oldestBtn = document.querySelector('[data-sort="date-asc"]');
            if (oldestBtn) oldestBtn.textContent = t.oldest;
            
            const titleBtn = document.querySelector('[data-sort="title"]');
            if (titleBtn) titleBtn.textContent = t.title;
            
            const allFilter = document.querySelector('[data-filter="all"]');
            if (allFilter) allFilter.textContent = t.allNotes;
            
            const pinnedFilter = document.querySelector('[data-filter="pinned"]');
            if (pinnedFilter) pinnedFilter.textContent = t.pinnedNotes;
            
            const normalFilter = document.querySelector('[data-filter="unpinned"]');
            if (normalFilter) normalFilter.textContent = t.normalNotes;
            
            // Update empty state
            const emptyState = document.getElementById('emptyState');
            emptyState.querySelector('h3').textContent = t.emptyStateTitle;
            emptyState.querySelector('p').textContent = t.emptyStateDesc;
            
            // Update privacy policy with error handling
            try {
                const privacyTitle = document.querySelector('#privacyTitle');
                if (privacyTitle) privacyTitle.textContent = t.privacyTitle;
                
                const dataCollectionLabel = document.querySelector('#dataCollectionLabel');
                if (dataCollectionLabel) dataCollectionLabel.textContent = t.dataCollection + ':';
                
                const dataCollectionText = document.querySelector('#dataCollectionText');
                if (dataCollectionText) dataCollectionText.textContent = t.dataCollectionText;
                
                const dataStorageLabel = document.querySelector('#dataStorageLabel');
                if (dataStorageLabel) dataStorageLabel.textContent = t.dataStorage + ':';
                
                const dataStorageText = document.querySelector('#dataStorageText');
                if (dataStorageText) dataStorageText.textContent = t.dataStorageText;
                
                const cookiesLabel = document.querySelector('#cookiesLabel');
                if (cookiesLabel) cookiesLabel.textContent = t.cookies + ':';
                
                const cookiesText = document.querySelector('#cookiesText');
                if (cookiesText) cookiesText.textContent = t.cookiesText;
                
                const thirdPartyLabel = document.querySelector('#thirdPartyLabel');
                if (thirdPartyLabel) thirdPartyLabel.textContent = t.thirdParty + ':';
                
                const thirdPartyText = document.querySelector('#thirdPartyText');
                if (thirdPartyText) thirdPartyText.textContent = t.thirdPartyText;
                
                const securityLabel = document.querySelector('#securityLabel');
                if (securityLabel) securityLabel.textContent = t.security + ':';
                
                const securityText = document.querySelector('#securityText');
                if (securityText) securityText.textContent = t.securityText;
                
                const contactLabel = document.querySelector('#contactLabel');
                if (contactLabel) contactLabel.textContent = t.contact + ':';
                
                const contactText = document.querySelector('#contactText');
                if (contactText) contactText.textContent = t.contactText;
                
                const copyrightText = document.querySelector('#copyrightText');
                if (copyrightText) copyrightText.textContent = t.copyright;
                
                // Update MIT License with error handling
                const mitLicenseElement = document.querySelector('#mitLicenseText');
                if (mitLicenseElement) {
                    mitLicenseElement.innerHTML = `<strong>${t.mitLicense}</strong> ${t.mitLicenseText} <a href="https://github.com/mutlukurt/Note-taking-app" target="_blank" rel="noopener">${t.githubRepo}</a>${t.visitText}`;
                }
            } catch (error) {
                console.log('Privacy policy translation error:', error);
            }
        }
        
        // Translation objects
        const translations = {
            tr: {
                appTitle: 'Not Alma Uygulaması',
                searchPlaceholder: 'Notlarda ara...',
                newNote: 'Yeni Not',
                deleteNote: 'Notu Sil',
                saveNote: 'Notu Kaydet',
                noteTitle: 'Not Başlığı',
                noteContent: 'Not içeriğini buraya yazın...',
                noNotes: 'Henüz not yok. İlk notunuzu oluşturun!',
                searchNoResults: 'Arama kriterlerine uygun not bulunamadı.',
                confirmDelete: 'Bu notu silmek istediğinizden emin misiniz?',
                exportNotes: 'Notları Dışa Aktar',
                importNotes: 'Notları İçe Aktar',
                darkMode: 'Karanlık Mod',
                lightMode: 'Aydınlık Mod',
                language: 'Dil',
                toolbarBold: 'Kalın',
                toolbarItalic: 'İtalik',
                toolbarUnderline: 'Altı Çizili',
                toolbarStrike: 'Üstü Çizili',
                toolbarImage: 'Resim Ekle',
                toolbarBackgroundColor: 'Metin Rengi',
                title: "Not Alma Uygulaması",
                noteTitlePlaceholder: "Not Başlığı",
                noteContentPlaceholder: "Not İçeriği",
                addNote: "Not Ekle",
                clear: "Temizle",
                exportPDF: "PDF Aktar",
                sortLabel: "Sırala:",
                newest: "En Yeni",
                oldest: "En Eski",
                title: "Not Alma Uygulaması",
                noteTitle: "Not Başlığı",
                noteContent: "Not İçeriği",
                addNote: "Not Ekle",
                clear: "Temizle",
                search: "Notlarda ara...",
                allNotes: "Tüm Notlar",
                pinnedNotes: "Sabitlenenler",
                normalNotes: "Normal Notlar",
                newest: "En Yeni",
                oldest: "En Eski",
                byTitle: "Başlık",
                edit: "Düzenle",
                delete: "Sil",
                pin: "Sabitle",
                unpin: "Sabitlemeyi Kaldır",
                save: "Kaydet",
                cancel: "İptal",
                undo: "Geri Al",
                emptyStateTitle: "Henüz not eklenmemiş",
                emptyStateDesc: "İlk notunuzu ekleyerek başlayın!",
                
                // Privacy Policy Translations
                privacyTitle: "🔒 Gizlilik Politikası",
                dataCollection: "Veri Toplama",
                dataCollectionText: "Bu uygulama hiçbir kişisel veri toplamaz. Tüm notlarınız sadece tarayıcınızda saklanır.",
                dataStorage: "Veri Saklama",
                dataStorageText: "Notlarınız LocalStorage kullanılarak yerel olarak saklanır. Hiçbir veri sunucuya gönderilmez.",
                cookies: "Çerezler",
                cookiesText: "Uygulama sadece tema ve dil tercihlerinizi saklamak için gerekli çerezleri kullanır.",
                thirdParty: "Üçüncü Taraf",
                thirdPartyText: "Font Awesome ikonları ve PDF kütüphaneleri için CDN kullanılır. Bu servisler sadece uygulama işlevselliği için gereklidir.",
                security: "Güvenlik",
                securityText: "Tüm verileriniz tarayıcınızda güvenli şekilde saklanır ve şifrelenir.",
                contact: "İletişim",
                contactText: "Sorularınız için GitHub üzerinden iletişime geçebilirsiniz.",
                copyright: "© 2025 Not Alma Uygulaması | MIT License",
                mitLicense: "MIT Lisansı:",
                mitLicenseText: "Bu proje açık kaynak kodludur. Kaynak kodu serbestçe kullanabilir, değiştirebilir ve dağıtabilirsiniz. Detaylar için",
                githubRepo: "GitHub deposunu",
                visitText: "ziyaret edin."
            },
            en: {
                appTitle: 'Note Taking App',
                searchPlaceholder: 'Search notes...',
                newNote: 'New Note',
                deleteNote: 'Delete Note',
                saveNote: 'Save Note',
                noteTitle: 'Note Title',
                noteContent: 'Write your note content here...',
                noNotes: 'No notes yet. Create your first note!',
                searchNoResults: 'No notes found matching your search criteria.',
                confirmDelete: 'Are you sure you want to delete this note?',
                exportNotes: 'Export Notes',
                importNotes: 'Import Notes',
                darkMode: 'Dark Mode',
                lightMode: 'Light Mode',
                language: 'Language',
                toolbarBold: 'Bold',
                toolbarItalic: 'Italic',
                toolbarUnderline: 'Underline',
                toolbarStrike: 'Strikethrough',
                toolbarImage: 'Add Image',
                toolbarBackgroundColor: 'Text Color',
                title: "Note Taking App",
                noteTitlePlaceholder: "Note Title",
                noteContentPlaceholder: "Note Content",
                addNote: "Add Note",
                clear: "Clear",
                exportPDF: "Export PDF",
                sortLabel: "Sort:",
                newest: "Newest",
                oldest: "Oldest",
                byTitle: "Title",
                edit: "Edit",
                delete: "Delete",
                pin: "Pin",
                unpin: "Unpin",
                save: "Save",
                cancel: "Cancel",
                undo: "Undo",
                emptyStateTitle: "No notes yet",
                emptyStateDesc: "Start by adding your first note!",
                
                // Privacy Policy Translations
                privacyTitle: "🔒 Privacy Policy",
                dataCollection: "Data Collection",
                dataCollectionText: "This application does not collect any personal data. All your notes are stored only in your browser.",
                dataStorage: "Data Storage",
                dataStorageText: "Your notes are stored locally using LocalStorage. No data is sent to any server.",
                cookies: "Cookies",
                cookiesText: "The application only uses necessary cookies to store your theme and language preferences.",
                thirdParty: "Third Party",
                thirdPartyText: "CDN is used for Font Awesome icons and PDF libraries. These services are only required for application functionality.",
                security: "Security",
                securityText: "All your data is stored securely and encrypted in your browser.",
                contact: "Contact",
                contactText: "For questions, you can contact us via GitHub.",
                copyright: "© 2025 Note Taking App | MIT License",
                mitLicense: "MIT License:",
                mitLicenseText: "This project is open source. You are free to use, modify, and distribute it. For details, visit",
                githubRepo: "GitHub repository",
                visitText: "."
            }
        };
        
        // Translate to English
        function translateToEnglish() {
            const t = translations.en;
            
            // Update main elements
            document.querySelector('.app-title').innerHTML = `<i class="fas fa-sticky-note"></i> ${t.appTitle}`;
            document.querySelector('.settings-label').textContent = t.themeLabel;
            document.getElementById('noteTitle').placeholder = t.noteTitlePlaceholder;
            document.getElementById('noteContent').setAttribute('data-placeholder', t.noteContentPlaceholder);
            document.getElementById('addNote').innerHTML = `<i class="fas fa-plus"></i> ${t.addNote}`;
            document.getElementById('clearForm').innerHTML = `<i class="fas fa-eraser"></i> ${t.clearForm}`;
            document.getElementById('exportPDF').innerHTML = `<i class="fas fa-file-pdf"></i> ${t.exportPDF}`;
            document.getElementById('searchInput').placeholder = t.searchPlaceholder;
            
            // Update toolbar buttons
            document.querySelector('[data-command="bold"]').title = t.toolbarBold;
            document.querySelector('[data-command="italic"]').title = t.toolbarItalic;
            document.querySelector('[data-command="underline"]').title = t.toolbarUnderline;
            document.querySelector('[data-command="strikeThrough"]').title = t.toolbarStrike;
            document.querySelector('[data-command="insertUnorderedList"]').title = t.toolbarList;
            document.querySelector('[data-command="insertOrderedList"]').title = t.toolbarOrderedList;
            document.querySelector('[data-command="justifyLeft"]').title = t.toolbarLeft;
            document.querySelector('[data-command="justifyCenter"]').title = t.toolbarCenter;
            document.querySelector('[data-command="justifyRight"]').title = t.toolbarRight;
            document.getElementById('imageBtn').title = t.toolbarImage;
            document.getElementById('colorPaletteBtn').title = t.toolbarBackgroundColor;
            
            // Update controls
            const sortSpan = document.querySelector('.sort-controls span');
            if (sortSpan) sortSpan.textContent = t.sortLabel;
            
            const newestBtn = document.querySelector('[data-sort="date-desc"]');
            if (newestBtn) newestBtn.textContent = t.newest;
            
            const oldestBtn = document.querySelector('[data-sort="date-asc"]');
            if (oldestBtn) oldestBtn.textContent = t.oldest;
            
            const titleBtn = document.querySelector('[data-sort="title"]');
            if (titleBtn) titleBtn.textContent = t.title;
            
            const allFilter = document.querySelector('[data-filter="all"]');
            if (allFilter) allFilter.textContent = t.allNotes;
            
            const pinnedFilter = document.querySelector('[data-filter="pinned"]');
            if (pinnedFilter) pinnedFilter.textContent = t.pinnedNotes;
            
            const normalFilter = document.querySelector('[data-filter="unpinned"]');
            if (normalFilter) normalFilter.textContent = t.normalNotes;
            
            // Update empty state
            const emptyState = document.getElementById('emptyState');
            emptyState.querySelector('h3').textContent = t.emptyStateTitle;
            emptyState.querySelector('p').textContent = t.emptyStateDesc;
            
            // Update privacy policy and MIT license
            updatePrivacyPolicyTranslation('en');
        }
        
        // Translate to Turkish
        function translateToTurkish() {
            const t = translations.tr;
            
            // Update main elements
            document.querySelector('.app-title').innerHTML = `<i class="fas fa-sticky-note"></i> ${t.appTitle}`;
            document.querySelector('.settings-label').textContent = t.themeLabel;
            document.getElementById('noteTitle').placeholder = t.noteTitlePlaceholder;
            document.getElementById('noteContent').setAttribute('data-placeholder', t.noteContentPlaceholder);
            document.getElementById('addNote').innerHTML = `<i class="fas fa-plus"></i> ${t.addNote}`;
            document.getElementById('clearForm').innerHTML = `<i class="fas fa-eraser"></i> ${t.clearForm}`;
            document.getElementById('exportPDF').innerHTML = `<i class="fas fa-file-pdf"></i> ${t.exportPDF}`;
            document.getElementById('searchInput').placeholder = t.searchPlaceholder;
            
            // Update toolbar buttons
            document.querySelector('[data-command="bold"]').title = t.toolbarBold;
            document.querySelector('[data-command="italic"]').title = t.toolbarItalic;
            document.querySelector('[data-command="underline"]').title = t.toolbarUnderline;
            document.querySelector('[data-command="strikeThrough"]').title = t.toolbarStrike;
            document.querySelector('[data-command="insertUnorderedList"]').title = t.toolbarList;
            document.querySelector('[data-command="insertOrderedList"]').title = t.toolbarOrderedList;
            document.querySelector('[data-command="justifyLeft"]').title = t.toolbarLeft;
            document.querySelector('[data-command="justifyCenter"]').title = t.toolbarCenter;
            document.querySelector('[data-command="justifyRight"]').title = t.toolbarRight;
            document.getElementById('imageBtn').title = t.toolbarImage;
            document.getElementById('colorPaletteBtn').title = t.toolbarBackgroundColor;
            
            // Update controls
            const sortSpan = document.querySelector('.sort-controls span');
            if (sortSpan) sortSpan.textContent = t.sortLabel;
            
            const newestBtn = document.querySelector('[data-sort="date-desc"]');
            if (newestBtn) newestBtn.textContent = t.newest;
            
            const oldestBtn = document.querySelector('[data-sort="date-asc"]');
            if (oldestBtn) oldestBtn.textContent = t.oldest;
            
            const titleBtn = document.querySelector('[data-sort="title"]');
            if (titleBtn) titleBtn.textContent = t.title;
            
            const allFilter = document.querySelector('[data-filter="all"]');
            if (allFilter) allFilter.textContent = t.allNotes;
            
            const pinnedFilter = document.querySelector('[data-filter="pinned"]');
            if (pinnedFilter) pinnedFilter.textContent = t.pinnedNotes;
            
            const normalFilter = document.querySelector('[data-filter="unpinned"]');
            if (normalFilter) normalFilter.textContent = t.normalNotes;
            
            // Update empty state
            const emptyState = document.getElementById('emptyState');
            if (emptyState) {
                const h3 = emptyState.querySelector('h3');
                const p = emptyState.querySelector('p');
                if (h3) h3.textContent = t.emptyStateTitle;
                if (p) p.textContent = t.emptyStateDesc;
            }
            
            // Update privacy policy and MIT license
            updatePrivacyPolicyTranslation('tr');
        }

        // Function to update privacy policy and MIT license translations
        function updatePrivacyPolicyTranslation(lang) {
            const t = translations[lang];
            console.log('updatePrivacyPolicyTranslation called with lang:', lang);
            
            try {
                // Update privacy policy elements
                const privacyTitle = document.querySelector('#privacyTitle');
                console.log('privacyTitle element:', privacyTitle);
                if (privacyTitle) privacyTitle.textContent = t.privacyTitle;
                
                const dataCollectionLabel = document.querySelector('#dataCollectionLabel');
                console.log('dataCollectionLabel element:', dataCollectionLabel);
                if (dataCollectionLabel) dataCollectionLabel.textContent = t.dataCollection + ':';
                
                const dataCollectionText = document.querySelector('#dataCollectionText');
                console.log('dataCollectionText element:', dataCollectionText);
                if (dataCollectionText) dataCollectionText.textContent = t.dataCollectionText;
                
                const dataStorageLabel = document.querySelector('#dataStorageLabel');
                console.log('dataStorageLabel element:', dataStorageLabel);
                if (dataStorageLabel) dataStorageLabel.textContent = t.dataStorage + ':';
                
                const dataStorageText = document.querySelector('#dataStorageText');
                console.log('dataStorageText element:', dataStorageText);
                if (dataStorageText) dataStorageText.textContent = t.dataStorageText;
                
                const cookiesLabel = document.querySelector('#cookiesLabel');
                console.log('cookiesLabel element:', cookiesLabel);
                if (cookiesLabel) cookiesLabel.textContent = t.cookies + ':';
                
                const cookiesText = document.querySelector('#cookiesText');
                console.log('cookiesText element:', cookiesText);
                if (cookiesText) cookiesText.textContent = t.cookiesText;
                
                const thirdPartyLabel = document.querySelector('#thirdPartyLabel');
                console.log('thirdPartyLabel element:', thirdPartyLabel);
                if (thirdPartyLabel) thirdPartyLabel.textContent = t.thirdParty + ':';
                
                const thirdPartyText = document.querySelector('#thirdPartyText');
                console.log('thirdPartyText element:', thirdPartyText);
                if (thirdPartyText) thirdPartyText.textContent = t.thirdPartyText;
                
                const securityLabel = document.querySelector('#securityLabel');
                console.log('securityLabel element:', securityLabel);
                if (securityLabel) securityLabel.textContent = t.security + ':';
                
                const securityText = document.querySelector('#securityText');
                console.log('securityText element:', securityText);
                if (securityText) securityText.textContent = t.securityText;
                
                const contactLabel = document.querySelector('#contactLabel');
                console.log('contactLabel element:', contactLabel);
                if (contactLabel) contactLabel.textContent = t.contact + ':';
                
                const contactText = document.querySelector('#contactText');
                console.log('contactText element:', contactText);
                if (contactText) contactText.textContent = t.contactText;
                
                const copyrightText = document.querySelector('#copyrightText');
                console.log('copyrightText element:', copyrightText);
                if (copyrightText) copyrightText.textContent = t.copyright;
                
                // Update MIT License
                const mitLicenseElement = document.querySelector('#mitLicenseText');
                console.log('mitLicenseElement element:', mitLicenseElement);
                if (mitLicenseElement) {
                    mitLicenseElement.innerHTML = `<strong>${t.mitLicense}</strong> ${t.mitLicenseText} <a href="https://github.com/mutlukurt/Note-taking-app" target="_blank" rel="noopener">${t.githubRepo}</a>${t.visitText}`;
                }
                
                console.log('Privacy policy translation completed successfully');
            } catch (error) {
                console.log('Privacy policy translation error:', error);
            }
        }

        // Translation objects
    </script>
    
    <script>
        // Global functions for settings panel
        function toggleSettings() {
            console.log('toggleSettings called');
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsPanel = document.getElementById('settingsPanel');
            
            if (settingsToggle && settingsPanel) {
                settingsToggle.classList.toggle('active');
                settingsPanel.classList.toggle('active');
                console.log('Settings panel toggled');
            } else {
                console.error('Settings elements not found');
            }
        }

        function toggleLanguage() {
            console.log('toggleLanguage called');
            const languageToggle = document.getElementById('languageToggle');
            const langText = languageToggle.querySelector('.lang-text');
            
            if (languageToggle && langText) {
                let newLang = 'tr';
                if (langText.textContent === 'TR') {
                    langText.textContent = 'EN';
                    languageToggle.classList.add('english');
                    newLang = 'en';
                    alert('Dil İngilizce olarak değiştirildi');
                } else {
                    langText.textContent = 'TR';
                    languageToggle.classList.remove('english');
                    newLang = 'tr';
                    alert('Dil Türkçe olarak değiştirildi');
                }
                
                // Apply translations to the page
                applyTranslations(newLang);
            }
        }

        function applyTranslations(lang) {
            const t = translations[lang];
            
            // Update main elements
            document.querySelector('.app-title').innerHTML = `<i class="fas fa-sticky-note"></i> ${t.appTitle}`;
            document.querySelector('.settings-label').textContent = t.language;
            document.getElementById('noteTitle').placeholder = t.noteTitlePlaceholder;
            document.getElementById('noteContent').setAttribute('data-placeholder', t.noteContentPlaceholder);
            document.getElementById('addNote').innerHTML = `<i class="fas fa-plus"></i> ${t.addNote}`;
            document.getElementById('clearForm').innerHTML = `<i class="fas fa-eraser"></i> ${t.clearForm}`;
            document.getElementById('exportPDF').innerHTML = `<i class="fas fa-file-pdf"></i> ${t.exportPDF}`;
            document.getElementById('searchInput').placeholder = t.searchPlaceholder;
            
            // Update toolbar buttons
            document.querySelector('[data-command="bold"]').title = t.toolbarBold;
            document.querySelector('[data-command="italic"]').title = t.toolbarItalic;
            document.querySelector('[data-command="underline"]').title = t.toolbarUnderline;
            document.querySelector('[data-command="strikeThrough"]').title = t.toolbarStrike;
            document.querySelector('[data-command="insertUnorderedList"]').title = t.toolbarList;
            document.querySelector('[data-command="insertOrderedList"]').title = t.toolbarOrderedList;
            document.querySelector('[data-command="justifyLeft"]').title = t.toolbarLeft;
            document.querySelector('[data-command="justifyCenter"]').title = t.toolbarCenter;
            document.querySelector('[data-command="justifyRight"]').title = t.toolbarRight;
            document.getElementById('imageBtn').title = t.toolbarImage;
            document.getElementById('colorPaletteBtn').title = t.toolbarBackgroundColor;
            
            // Update controls
            const sortSpan = document.querySelector('.sort-controls span');
            if (sortSpan) sortSpan.textContent = t.sortLabel;
            
            const newestBtn = document.querySelector('[data-sort="date-desc"]');
            if (newestBtn) newestBtn.textContent = t.newest;
            
            const oldestBtn = document.querySelector('[data-sort="date-asc"]');
            if (oldestBtn) oldestBtn.textContent = t.oldest;
            
            const titleBtn = document.querySelector('[data-sort="title"]');
            if (titleBtn) titleBtn.textContent = t.title;
            
            const allFilter = document.querySelector('[data-filter="all"]');
            if (allFilter) allFilter.textContent = t.allNotes;
            
            const pinnedFilter = document.querySelector('[data-filter="pinned"]');
            if (pinnedFilter) pinnedFilter.textContent = t.pinnedNotes;
            
            const normalFilter = document.querySelector('[data-filter="unpinned"]');
            if (normalFilter) normalFilter.textContent = t.normalNotes;
            
            // Update empty state
            const emptyState = document.getElementById('emptyState');
            if (emptyState) {
                emptyState.querySelector('h3').textContent = t.emptyStateTitle;
                emptyState.querySelector('p').textContent = t.emptyStateDesc;
            }
            
            // Update privacy policy and MIT license
            updatePrivacyPolicyTranslation(lang);
        }

        // Mobile touch support
        document.addEventListener('DOMContentLoaded', function() {
            // Touch events for mobile
            const settingsToggle = document.getElementById('settingsToggle');
            const languageToggle = document.getElementById('languageToggle');
            
            if (settingsToggle) {
                settingsToggle.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    toggleSettings();
                });
            }
            
            if (languageToggle) {
                languageToggle.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    toggleLanguage();
                });
            }
        });
    </script>
    
    <!-- Color palette modal removed - colors now in toolbar -->
    
    <script src="script.js"></script>
    
    <!-- Gizlilik Politikası ve Lisans -->
    <footer class="privacy-policy">
        <div class="container">
            <div class="privacy-content">
                <h3 id="privacyTitle">🔒 Gizlilik Politikası</h3>
                <div class="privacy-text">
                    <p id="dataCollectionSection"><strong id="dataCollectionLabel">Veri Toplama:</strong> <span id="dataCollectionText">Bu uygulama hiçbir kişisel veri toplamaz. Tüm notlarınız sadece tarayıcınızda saklanır.</span></p>
                    <p id="dataStorageSection"><strong id="dataStorageLabel">Veri Saklama:</strong> <span id="dataStorageText">Notlarınız LocalStorage kullanılarak yerel olarak saklanır. Hiçbir veri sunucuya gönderilmez.</span></p>
                    <p id="cookiesSection"><strong id="cookiesLabel">Çerezler:</strong> <span id="cookiesText">Uygulama sadece tema ve dil tercihlerinizi saklamak için gerekli çerezleri kullanır.</span></p>
                    <p id="thirdPartySection"><strong id="thirdPartyLabel">Üçüncü Taraf:</strong> <span id="thirdPartyText">Font Awesome ikonları ve PDF kütüphaneleri için CDN kullanılır. Bu servisler sadece uygulama işlevselliği için gereklidir.</span></p>
                    <p id="securitySection"><strong id="securityLabel">Güvenlik:</strong> <span id="securityText">Tüm verileriniz tarayıcınızda güvenli şekilde saklanır ve şifrelenir.</span></p>
                    <p id="contactSection"><strong id="contactLabel">İletişim:</strong> <span id="contactText">Sorularınız için GitHub üzerinden iletişime geçebilirsiniz.</span></p>
                </div>
                <div class="privacy-links">
                    <span id="copyrightText">© 2025 Not Alma Uygulaması | MIT License</span>
                    <div class="license-info">
                        <p id="mitLicenseText">
                            <strong>MIT Lisansı:</strong> Bu proje açık kaynak kodludur. Kaynak kodu serbestçe kullanabilir, değiştirebilir ve dağıtabilirsiniz. 
                            Detaylar için <a href="https://github.com/mutlukurt/Note-taking-app" target="_blank" rel="noopener">GitHub deposunu</a> ziyaret edin.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>