<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Not Alma Uygulaması</title>
    

    
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="light-mode">
    <div class="container">
        <header class="header">
            <h1 class="app-title">
                <i class="fas fa-sticky-note"></i>
                Not Alma Uygulaması
            </h1>
        </header>
        
        <!-- Tema kontrol bölümü -->
        <div class="theme-control-section">
            <div class="theme-control-content">
                <span class="theme-label">Tema Seçimi</span>
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-sun"></i>
                </button>
            </div>
        </div>

        <div class="note-form">
            <div class="input-group">
                <input type="text" id="noteTitle" placeholder="Not başlığı..." class="note-input">
                
                <!-- Rich Text Editor Toolbar -->
                <div class="editor-toolbar">
                    <button type="button" class="toolbar-btn" data-command="bold" title="Kalın">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="italic" title="İtalik">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="underline" title="Altı Çizili">
                        <i class="fas fa-underline"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="strikeThrough" title="Üstü Çizili">
                        <i class="fas fa-strikethrough"></i>
                    </button>
                    <div class="toolbar-separator"></div>
                    <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Liste">
                        <i class="fas fa-list-ul"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Numaralı Liste">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <div class="toolbar-separator"></div>
                    <button type="button" class="toolbar-btn" data-command="justifyLeft" title="Sola Hizala">
                        <i class="fas fa-align-left"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="justifyCenter" title="Ortala">
                        <i class="fas fa-align-center"></i>
                    </button>
                    <button type="button" class="toolbar-btn" data-command="justifyRight" title="Sağa Hizala">
                        <i class="fas fa-align-right"></i>
                    </button>
                    <div class="toolbar-separator"></div>
                    <button type="button" class="toolbar-btn" id="addImageBtn" title="Fotoğraf Ekle">
                        <i class="fas fa-image"></i>
                    </button>
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                </div>
                
                <div id="noteContent" class="note-textarea rich-editor" contenteditable="true" data-placeholder="Notunuzu buraya yazın..."></div>
            </div>
            <div class="button-group">
                <button id="addNote" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    Not Ekle
                </button>
                <button id="clearForm" class="btn btn-secondary">
                    <i class="fas fa-eraser"></i>
                    Temizle
                </button>
                <button id="exportPDF" class="btn btn-export">
                    <i class="fas fa-file-pdf"></i>
                    PDF Aktar
                </button>
            </div>
        </div>

        <div class="search-section">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Notlarınızda arayın..." class="search-input">
            </div>
        </div>

        <div class="notes-controls">
            <div class="sort-controls">
                <span style="color: var(--text-secondary); font-size: 0.9rem; margin-right: 10px;">Sırala:</span>
                <button class="sort-btn active" data-sort="date-desc">En Yeni</button>
                <button class="sort-btn" data-sort="date-asc">En Eski</button>
                <button class="sort-btn" data-sort="title">Başlık</button>
            </div>
            <div class="pin-controls">
                <button class="pin-filter active" data-filter="all">Tümü</button>
                <button class="pin-filter" data-filter="pinned">Sabitlenenler</button>
                <button class="pin-filter" data-filter="unpinned">Normal</button>
            </div>
        </div>

        <div class="notes-container" id="notesContainer">
            <!-- Notlar buraya dinamik olarak eklenecek -->
        </div>

        <div class="empty-state" id="emptyState">
            <i class="fas fa-notes-medical"></i>
            <h3>Henüz not eklenmemiş</h3>
            <p>İlk notunuzu ekleyerek başlayın!</p>
        </div>
    </div>

    <script>
        // Simple test functions
        function testTheme() {
            console.log('Test theme function called');
            const body = document.body;
            const icon = document.querySelector('#themeToggle i');
            
            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                icon.className = 'fas fa-sun';
                console.log('Light mode activated');
            } else {
                body.classList.add('dark-mode');
                icon.className = 'fas fa-moon';
                console.log('Dark mode activated');
            }
        }
        
        function testAddNote() {
            console.log('Test add note function called');
            const title = document.getElementById('noteTitle').value;
            const content = document.getElementById('noteContent').innerHTML;
            
            if (!title && !content) {
                alert('Lütfen en az bir başlık veya içerik girin!');
                return;
            }
            
            // Create note object
            const note = {
                id: Date.now(),
                title: title || 'Başlıksız Not',
                content: content || 'İçerik yok',
                date: new Date().toLocaleString('tr-TR'),
                timestamp: Date.now(),
                pinned: false
            };
            
            // Get notes from localStorage
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            notes.push(note);
            localStorage.setItem('notes', JSON.stringify(notes));
            
            // Clear form
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').innerHTML = '';
            
            // Show success message
            alert('Not başarıyla eklendi!');
            
            // Refresh notes display
            renderNotes();
        }
        
        function testClearForm() {
            console.log('Test clear form function called');
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteContent').innerHTML = '';
            console.log('Form cleared');
        }
        
        // DOM loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up test buttons...');
            
            // Set up test buttons
            const themeBtn = document.getElementById('themeToggle');
            if (themeBtn) {
                themeBtn.onclick = testTheme;
                console.log('Theme button set up');
            }
            
            const addBtn = document.getElementById('addNote');
            if (addBtn) {
                addBtn.onclick = testAddNote;
                console.log('Add note button set up');
            }
            
            const clearBtn = document.getElementById('clearForm');
            if (clearBtn) {
                clearBtn.onclick = testClearForm;
                console.log('Clear form button set up');
            }
            
            // Set up search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.oninput = (e) => {
                    searchNotes(e.target.value);
                };
                console.log('Search input set up');
            }
            
            // Set up PDF export button
            const exportBtn = document.getElementById('exportPDF');
            if (exportBtn) {
                exportBtn.onclick = exportToPDF;
                console.log('PDF export button set up');
            }
            
            // Set up rich text editor toolbar
            setupRichTextEditor();
            console.log('Rich text editor set up');
            
            console.log('Test buttons set up successfully!');
            
            // Load and display notes
            renderNotes();
        });
        
        // Function to render notes
        function renderNotes() {
            const notes = JSON.parse(localStorage.getItem('notes')) || [];
            const container = document.getElementById('notesContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (notes.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'flex';
                return;
            }
            
            emptyState.style.display = 'none';
            container.innerHTML = '';
            
            notes.forEach(note => {
                const noteCard = createNoteCard(note);
                container.appendChild(noteCard);
            });
        }
        
        // Function to create note card
        function createNoteCard(note) {
            const card = document.createElement('div');
            card.className = 'note-card';
            if (note.pinned) card.classList.add('pinned');
            
            card.innerHTML = `
                <div class="note-header">
                    <h3 class="note-title">${note.title}</h3>
                    <span class="note-date">${note.date}</span>
                </div>
                <div class="note-content">${note.content}</div>
                <div class="note-actions">
                    <button class="action-btn pin" onclick="togglePin(${note.id})" title="Sabitle">
                        <i class="fas fa-thumbtack"></i>
                    </button>
                    <button class="action-btn edit" onclick="editNote(${note.id})" title="Düzenle">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn delete" onclick="deleteNote(${note.id})" title="Sil">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="swipe-delete" data-note-id="${note.id}" onclick="deleteNoteWithUndo(${note.id})">
                    <i class="fas fa-trash"></i>
                    <span>Sil</span>
                </div>
            `;
            
            // Add swipe functionality after creating the card
            addSwipeFunctionality(card, note.id);
            
            return card;
        }
        
        // Function to delete note
        function deleteNote(id) {
            if (confirm('Bu notu silmek istediğinizden emin misiniz?')) {
                let notes = JSON.parse(localStorage.getItem('notes')) || [];
                notes = notes.filter(note => note.id !== id);
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotes();
                alert('Not silindi!');
            }
        }
        
        // Function to toggle pin
        function togglePin(id) {
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            const note = notes.find(note => note.id === id);
            if (note) {
                note.pinned = !note.pinned;
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotes();
            }
        }
        
        // Function to edit note
        function editNote(id) {
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            const note = notes.find(note => note.id === id);
            if (note) {
                document.getElementById('noteTitle').value = note.title;
                document.getElementById('noteContent').innerHTML = note.content;
                
                // Change add button to update button temporarily
                const addBtn = document.getElementById('addNote');
                addBtn.innerHTML = '<i class="fas fa-save"></i> Güncelle';
                addBtn.onclick = () => updateNote(id);
            }
        }
        
        // Function to update note
        function updateNote(id) {
            const title = document.getElementById('noteTitle').value;
            const content = document.getElementById('noteContent').innerHTML;
            
            if (!title && !content) {
                alert('Lütfen en az bir başlık veya içerik girin!');
                return;
            }
            
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            const noteIndex = notes.findIndex(note => note.id === id);
            
            if (noteIndex !== -1) {
                notes[noteIndex].title = title || 'Başlıksız Not';
                notes[noteIndex].content = content || 'İçerik yok';
                notes[noteIndex].date = new Date().toLocaleString('tr-TR');
                
                localStorage.setItem('notes', JSON.stringify(notes));
                
                // Reset form and button
                document.getElementById('noteTitle').value = '';
                document.getElementById('noteContent').innerHTML = '';
                
                const addBtn = document.getElementById('addNote');
                addBtn.innerHTML = '<i class="fas fa-plus"></i> Not Ekle';
                addBtn.onclick = testAddNote;
                
                renderNotes();
                alert('Not güncellendi!');
            }
        }
        
        // Function to search notes
        function searchNotes(query) {
            const notes = JSON.parse(localStorage.getItem('notes')) || [];
            const container = document.getElementById('notesContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (!query.trim()) {
                renderNotes();
                return;
            }
            
            const filteredNotes = notes.filter(note => 
                note.title.toLowerCase().includes(query.toLowerCase()) ||
                note.content.toLowerCase().includes(query.toLowerCase())
            );
            
            if (filteredNotes.length === 0) {
                container.innerHTML = '';
                emptyState.innerHTML = `
                    <i class="fas fa-search"></i>
                    <h3>Arama sonucu bulunamadı</h3>
                    <p>"${query}" için sonuç yok</p>
                `;
                emptyState.style.display = 'flex';
                return;
            }
            
            emptyState.style.display = 'none';
            container.innerHTML = '';
            
            filteredNotes.forEach(note => {
                const noteCard = createNoteCard(note);
                container.appendChild(noteCard);
            });
        }
        
        // Swipe functionality
        function addSwipeFunctionality(card, noteId) {
            let startX = 0;
            let currentX = 0;
            let isDragging = false;
            let isSwiped = false;
            
            // Mouse events for desktop testing
            card.addEventListener('mousedown', (e) => {
                startX = e.clientX;
                isDragging = true;
                card.style.cursor = 'grabbing';
            });
            
            card.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                currentX = e.clientX;
                const diff = startX - currentX;
                
                if (diff > 0) {
                    card.style.transform = `translateX(-${Math.min(diff, 80)}px)`;
                }
            });
            
            card.addEventListener('mouseup', () => {
                if (!isDragging) return;
                
                const diff = startX - currentX;
                if (diff > 80) {
                    card.style.transform = 'translateX(-80px)';
                    isSwiped = true;
                } else {
                    card.style.transform = 'translateX(0)';
                    isSwiped = false;
                }
                
                isDragging = false;
                card.style.cursor = 'grab';
            });
            
            // Touch events for mobile
            card.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
            });
            
            card.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                
                currentX = e.touches[0].clientX;
                const diff = startX - currentX;
                
                if (diff > 0) {
                    e.preventDefault();
                    card.style.transform = `translateX(-${Math.min(diff, 80)}px)`;
                }
            });
            
            card.addEventListener('touchend', () => {
                if (!isDragging) return;
                
                const diff = startX - currentX;
                if (diff > 80) {
                    card.style.transform = 'translateX(-80px)';
                    isSwiped = true;
                } else {
                    card.style.transform = 'translateX(0)';
                    isSwiped = false;
                }
                
                isDragging = false;
            });
            
            // Click outside to reset
            document.addEventListener('click', (e) => {
                if (!card.contains(e.target) && isSwiped) {
                    card.style.transform = 'translateX(0)';
                    isSwiped = false;
                }
            });
            
            // Add click event to swipe delete button
            const swipeDeleteBtn = card.querySelector('.swipe-delete');
            if (swipeDeleteBtn) {
                swipeDeleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteNoteWithUndo(noteId);
                    card.style.transform = 'translateX(0)';
                    isSwiped = false;
                });
            }
        }
        
        // Delete note with undo
        function deleteNoteWithUndo(id) {
            const noteId = parseInt(id);
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            const noteIndex = notes.findIndex(note => note.id === noteId);
            
            if (noteIndex === -1) return;
            
            const deletedNote = notes[noteIndex];
            notes.splice(noteIndex, 1);
            localStorage.setItem('notes', JSON.stringify(notes));
            
            // Show undo notification
            showUndoNotification(deletedNote, noteIndex);
            
            // Refresh display
            renderNotes();
        }
        
        // Show undo notification
        function showUndoNotification(note, originalIndex) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'undo-notification';
            notification.innerHTML = `
                <span>Not silindi</span>
                <button onclick="undoDelete(${note.id}, ${originalIndex})">Geri Al</button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 4000);
        }
        
        // Undo delete
        function undoDelete(noteId, originalIndex) {
            let notes = JSON.parse(localStorage.getItem('notes')) || [];
            const deletedNote = notes.find(note => note.id === noteId);
            
            if (deletedNote) {
                notes.splice(originalIndex, 0, deletedNote);
                localStorage.setItem('notes', JSON.stringify(notes));
                renderNotes();
            }
            
            // Remove notification
            const notification = document.querySelector('.undo-notification');
            if (notification) {
                notification.parentNode.removeChild(notification);
            }
        }
        
        // PDF Export Function
        function exportToPDF() {
            const title = document.getElementById('noteTitle').value;
            const content = document.getElementById('noteContent').innerHTML;
            
            if (!title && !content) {
                alert('PDF oluşturmak için en az bir başlık veya içerik girin!');
                return;
            }
            
            // Create a temporary container for PDF content
            const pdfContainer = document.createElement('div');
            pdfContainer.style.cssText = `
                position: fixed;
                top: -9999px;
                left: -9999px;
                width: 800px;
                background: white;
                padding: 40px;
                font-family: Arial, sans-serif;
                color: #333;
                line-height: 1.6;
            `;
            
            pdfContainer.innerHTML = `
                <h1 style="color: #667eea; margin-bottom: 20px; font-size: 24px;">${title || 'Başlıksız Not'}</h1>
                <div style="margin-bottom: 20px; color: #666; font-size: 14px;">
                    Oluşturulma Tarihi: ${new Date().toLocaleString('tr-TR')}
                </div>
                <div style="font-size: 16px;">${content || 'İçerik yok'}</div>
            `;
            
            document.body.appendChild(pdfContainer);
            
            // Use html2canvas to capture the content
            html2canvas(pdfContainer, {
                scale: 2,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                // Remove the temporary container
                document.body.removeChild(pdfContainer);
                
                // Create PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const imgData = canvas.toDataURL('image/png');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = pdfWidth;
                const pageHeight = pdfHeight;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Download the PDF
                const fileName = `${title || 'not'}_${new Date().toISOString().slice(0, 10)}.pdf`;
                pdf.save(fileName);
                
                alert('PDF başarıyla indirildi!');
            }).catch(error => {
                console.error('PDF oluşturma hatası:', error);
                alert('PDF oluşturulurken bir hata oluştu. Lütfen tekrar deneyin.');
                document.body.removeChild(pdfContainer);
            });
        }
        
        // Rich Text Editor Setup
        function setupRichTextEditor() {
            const toolbar = document.querySelector('.editor-toolbar');
            const editor = document.getElementById('noteContent');
            const imageInput = document.getElementById('imageInput');
            
            // Toolbar button clicks
            toolbar.addEventListener('click', (e) => {
                if (e.target.closest('.toolbar-btn')) {
                    const btn = e.target.closest('.toolbar-btn');
                    const command = btn.dataset.command;
                    
                    if (command) {
                        e.preventDefault();
                        document.execCommand(command, false, null);
                        editor.focus();
                    }
                }
            });
            
            // Image upload
            const addImageBtn = document.getElementById('addImageBtn');
            if (addImageBtn) {
                addImageBtn.addEventListener('click', () => {
                    imageInput.click();
                });
            }
            
            if (imageInput) {
                imageInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.style.maxWidth = '100%';
                            img.style.height = 'auto';
                            img.style.borderRadius = '10px';
                            img.style.margin = '10px 0';
                            
                            editor.focus();
                            document.execCommand('insertHTML', false, img.outerHTML);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        }
    </script>
    <script src="script.js"></script>
</body>
</html>